<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lexi ‚Äî My Favorite Person</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@400;600&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#fff0f6;
      --bg2:#ffe3ec;
      --ink:#2b2b2f;
      --muted:#6a5d6a;
      --rose:#ff4d8d;
      --rose2:#ff85a8;
      --paper:#fffafc;
      --paper2:#fff3f8;
      --edge:#f0d7e4;
      --shadow: 0 20px 60px rgba(35, 10, 25, .18);
      --shadow2: 0 10px 30px rgba(35, 10, 25, .14);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at 20% 20%, #ffffff 0%, transparent 55%),
        radial-gradient(900px 700px at 85% 25%, #ffffff 0%, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
    }

    /* subtle floating hearts in background */
    .bg-hearts{
      position:fixed; inset:0; pointer-events:none; overflow:hidden;
      filter: drop-shadow(0 8px 12px rgba(0,0,0,.06));
      opacity:.55;
    }
    .heart{
      position:absolute;
      width:16px; height:16px;
      transform: rotate(45deg);
      background: linear-gradient(135deg, rgba(255,77,141,.85), rgba(255,133,168,.75));
      border-radius: 4px;
      animation: floatUp linear infinite;
    }
    .heart::before,.heart::after{
      content:"";
      position:absolute; width:16px; height:16px;
      background: inherit;
      border-radius:50%;
    }
    .heart::before{ left:-8px; top:0;}
    .heart::after{ top:-8px; left:0;}
    @keyframes floatUp{
      from{ transform: translateY(20vh) rotate(45deg); opacity:0;}
      10%{opacity:.85}
      to{ transform: translateY(-120vh) rotate(45deg); opacity:0;}
    }

    /* Layout */
    .wrap{
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    .stage{
      width:min(980px, 96vw);
      height:min(660px, 86vh);
      position:relative;
      perspective: 1400px;
    }

    .hint{
      position:absolute;
      top:-40px; left:0; right:0;
      text-align:center;
      font-size:13px;
      color:rgba(60,25,45,.65);
      user-select:none;
    }
    .hint kbd{
      font: 600 12px/1 Inter, sans-serif;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.65);
      border:1px solid rgba(240, 170, 200, .65);
      box-shadow: 0 8px 16px rgba(0,0,0,.05);
    }

    /* Card Book */
    .book{
      width:100%;
      height:100%;
      position:relative;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background:
        radial-gradient(120% 180% at 0% 0%, rgba(255,255,255,.85), rgba(255,255,255,.15)),
        linear-gradient(135deg, rgba(255,255,255,.65), rgba(255,255,255,.35));
      padding:18px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 133, 168, .35);
      touch-action: pan-y; /* allow vertical scroll inside pages */
    }

    .book-inner{
      width:100%;
      height:100%;
      position:relative;
      border-radius: calc(var(--radius) - 8px);
      background: linear-gradient(135deg, rgba(255,255,255,.88), rgba(255,255,255,.76));
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(240, 170, 200, .25);
    }

    /* Navigation tap zones */
    .nav-zone{
      position:absolute; top:0; bottom:0;
      width:18%;
      z-index:80;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .nav-left{ left:0;}
    .nav-right{ right:0;}
    .nav-zone::after{
      content:"";
      position:absolute; inset:0;
      opacity:0;
      transition:opacity .2s ease;
    }
    .nav-left::after{
      background: linear-gradient(90deg, rgba(255,77,141,.18), transparent);
    }
    .nav-right::after{
      background: linear-gradient(270deg, rgba(255,77,141,.18), transparent);
    }
    .nav-zone:hover::after{opacity:1}

    /* Pages stack */
    .pages{
      position:absolute; inset:0;
      border-radius: calc(var(--radius) - 8px);
    }

    .page{
      position:absolute; inset:0;
      border-radius: calc(var(--radius) - 8px);
      background: linear-gradient(135deg, var(--paper), var(--paper2));
      transform-style: preserve-3d;
      transform-origin: left center;
      box-shadow: var(--shadow2);
      border: 1px solid rgba(240, 170, 200, .35);
      overflow:hidden;
      transition: transform 850ms cubic-bezier(.2,.9,.2,1);
    }

    /* Paper edge + spine vibe */
    .page::before{
      content:"";
      position:absolute; left:0; top:0; bottom:0;
      width:14px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.15)),
        linear-gradient(90deg, rgba(240,215,228,.9), rgba(240,215,228,.2));
      box-shadow: inset -1px 0 0 rgba(240,170,200,.25);
      opacity:.95;
      pointer-events:none;
    }

    .page.flipped{
      transform: rotateY(-180deg);
    }

    /* Page content wrapper now scrolls on mobile */
    .content{
      position:absolute;
      inset:0;
      padding: 40px 42px 36px 56px; /* extra left for edge */
      display:flex;
      flex-direction:column;
      gap:16px;
      overflow:hidden;
    }

    .scrollable{
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding-right: 10px;
      flex:1;
    }

    .topline{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      color: var(--muted);
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .badge{
      padding:7px 10px;
      border-radius:999px;
      background: rgba(255,77,141,.10);
      border: 1px solid rgba(255,77,141,.22);
      box-shadow: 0 8px 16px rgba(0,0,0,.04);
      font-weight:700;
      color: rgba(120, 35, 70, .9);
    }

    h1,h2,h3{margin:0}
    .cover-name{
      font-family: "Great Vibes", cursive;
      font-size: clamp(52px, 7.3vw, 86px);
      line-height: 1;
      letter-spacing: .02em;
      color: rgba(90, 20, 55, .95);
      text-shadow:
        0 2px 0 rgba(255,255,255,.8),
        0 18px 40px rgba(255,77,141,.18);
    }
    .engraved{ position:relative; }
    .engraved::after{
      content:"";
      position:absolute;
      left:0; right:0;
      bottom:-10px;
      height:2px;
      background: linear-gradient(90deg, transparent, rgba(255,77,141,.55), transparent);
      filter: blur(.2px);
    }

    .subtitle{
      font-family: "Playfair Display", serif;
      font-weight:600;
      font-size: clamp(18px, 2.2vw, 26px);
      color: rgba(70, 30, 50, .88);
    }

    .note{
      color: rgba(60,25,45,.75);
      font-size: 14px;
      line-height: 1.45;
      max-width: 56ch;
    }

    .divider{
      height:1px;
      width:100%;
      background: linear-gradient(90deg, transparent, rgba(255,77,141,.30), transparent);
      margin: 8px 0;
    }

    /* Reasons list */
    .reasons{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px 14px;
      margin-top:6px;
    }
    .reason{
      display:flex;
      gap:10px;
      padding:10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(240,170,200,.25);
      box-shadow: 0 10px 18px rgba(0,0,0,.04);
      align-items:flex-start;
      min-height: 44px;
    }
    .dot{
      width:22px; height:22px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,77,141,.92), rgba(255,133,168,.65));
      display:grid;
      place-items:center;
      color:white;
      font-weight:900;
      font-size:12px;
      flex:0 0 auto;
      box-shadow: 0 10px 18px rgba(255,77,141,.20);
    }
    .reason span{
      font-size: 13px;
      line-height: 1.25;
      color: rgba(45, 20, 35, .88);
      font-weight:600;
    }

    /* "Hard to see" secret messages */
    .secret-footer{
      margin-top: 16px;
      padding: 12px 12px 14px;
      border-radius: 16px;
      background: rgba(255,255,255,.30);
      border: 1px solid rgba(240,170,200,.18);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.25);
    }
    .secret-title{
      font-size: 11px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(90, 20, 55, .35);
      margin-bottom: 8px;
      font-weight: 800;
    }
    .secret-lines{
      display:grid;
      gap:8px;
      font-family: "Playfair Display", serif;
      font-size: 13px;
      color: rgba(90, 20, 55, .26); /* hard to see */
      line-height: 1.2;
    }

    /* Interactive Page 1: Scratch-to-reveal */
    .scratch-wrap{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      align-items:stretch;
      margin-top:8px;
    }
    .scratch-card{
      border-radius: 18px;
      background: rgba(255,255,255,.68);
      border: 1px solid rgba(240,170,200,.28);
      box-shadow: 0 12px 22px rgba(0,0,0,.05);
      padding:14px;
      position:relative;
      overflow:hidden;
      min-height: 300px;
    }
    .scratch-card h3{
      font-family:"Playfair Display", serif;
      font-size:18px;
      color: rgba(70, 25, 50, .9);
      margin-bottom:6px;
    }
    .scratch-card p{
      margin:0 0 10px;
      font-size: 13px;
      color: rgba(60,25,45,.72);
      line-height:1.35;
    }
    #scratchCanvas{
      width:100%;
      height: 190px;
      border-radius: 14px;
      display:block;
      background: transparent;
      border: 1px dashed rgba(255,77,141,.35);
      touch-action: none; /* allow drawing on iOS */
    }

    /* message UNDER the canvas so it cannot show early */
    .scratch-under{
      position:absolute;
      left:14px; right:14px;
      top: 92px; /* below heading and paragraph */
      height: 190px;
      border-radius: 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(135deg, rgba(255,77,141,.10), rgba(255,133,168,.08));
      border: 1px solid rgba(255,77,141,.18);
      box-shadow: 0 10px 18px rgba(0,0,0,.04);
      text-align:center;
      font-family:"Great Vibes", cursive;
      font-size: 34px;
      color: rgba(90, 20, 55, .92);
      user-select:none;
      pointer-events:none;
      z-index:1;
    }
    #scratchCanvas{ position:relative; z-index:2; }

    .mini-panel{
      border-radius: 18px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(240,170,200,.25);
      box-shadow: 0 12px 22px rgba(0,0,0,.05);
      padding:14px;
      min-height: 300px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .mini-panel h3{
      font-family:"Playfair Display", serif;
      font-size:18px;
      margin:0;
      color: rgba(70, 25, 50, .9);
    }
    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .chip{
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,77,141,.10);
      border: 1px solid rgba(255,77,141,.22);
      font-weight:800;
      font-size:12px;
      color: rgba(90, 20, 55, .9);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease;
    }
    .chip:active{ transform: scale(.98); }
    .chip:hover{ background: rgba(255,77,141,.14); }
    .jar-note{
      margin-top:auto;
      padding:12px;
      border-radius: 14px;
      background: rgba(255,255,255,.8);
      border: 1px solid rgba(240,170,200,.28);
      color: rgba(50, 20, 35, .85);
      font-size:13px;
      line-height:1.35;
      min-height: 92px; /* ensure visible */
      display:flex;
      align-items:center;
    }

    /* Interactive Page 2: Heart constellation */
    .constellation{
      position:relative;
      border-radius: 18px;
      background:
        radial-gradient(800px 300px at 20% 20%, rgba(255,255,255,.9), rgba(255,255,255,.45)),
        linear-gradient(135deg, rgba(255,77,141,.08), rgba(255,133,168,.06));
      border: 1px solid rgba(255,77,141,.18);
      box-shadow: 0 16px 30px rgba(0,0,0,.06);
      overflow:hidden;
      min-height: 360px;
    }
    .spark{
      position:absolute;
      width:14px; height:14px;
      transform: rotate(45deg);
      border-radius: 3px;
      background: linear-gradient(135deg, rgba(255,77,141,.92), rgba(255,133,168,.7));
      cursor:pointer;
      box-shadow: 0 12px 20px rgba(255,77,141,.22);
      transition: transform .12s ease;
      z-index:2;
    }
    .spark::before,.spark::after{
      content:"";
      position:absolute; width:14px; height:14px;
      background: inherit;
      border-radius:50%;
    }
    .spark::before{ left:-7px; top:0;}
    .spark::after{ top:-7px; left:0;}
    .spark:hover{ transform: rotate(45deg) scale(1.06); }

    /* Tooltip pinned to bottom so it never covers hearts */
    .tooltip{
      position:absolute;
      left:16px; right:16px; bottom:16px;
      padding:12px 14px;
      border-radius: 14px;
      background: rgba(255,255,255,.85);
      border: 1px solid rgba(240,170,200,.35);
      box-shadow: 0 18px 40px rgba(0,0,0,.08);
      font-size: 13px;
      color: rgba(50,20,35,.9);
      display:flex;
      gap:10px;
      align-items:flex-start;
      z-index:3;
    }
    .tooltip strong{font-weight:900}
    .tooltip .pill{
      margin-left:auto;
      padding:7px 10px;
      border-radius:999px;
      background: rgba(255,77,141,.10);
      border: 1px solid rgba(255,77,141,.22);
      font-weight:900;
      font-size:12px;
      color: rgba(90, 20, 55, .92);
      white-space:nowrap;
    }

    /* Final page buttons */
    .cta{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:14px;
      flex:1;
      padding-bottom: 10px;
    }
    .big-yes{
      width:min(420px, 86%);
      height:84px;
      border:0;
      border-radius: 18px;
      font-weight: 1000;
      font-size: 28px;
      color:white;
      cursor:pointer;
      background: linear-gradient(135deg, rgba(255,77,141,.98), rgba(255,133,168,.82));
      box-shadow: 0 22px 46px rgba(255,77,141,.28);
      transition: transform .12s ease, filter .12s ease;
      position:relative;
      z-index:2;
    }
    .big-yes:hover{ filter: brightness(1.02); }
    .big-yes:active{ transform: scale(.99); }

    .small-no{
      position:absolute;
      width:120px;
      height:38px;
      border-radius: 999px;
      border: 1px solid rgba(255,77,141,.28);
      background: rgba(255,255,255,.75);
      color: rgba(90, 20, 55, .92);
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 12px 24px rgba(0,0,0,.08);
      transition: transform .12s ease, background .12s ease;
      z-index:1; /* always below YES */
      left:50%;
      top: 67%;
      transform: translateX(-50%);
    }
    .small-no:hover{ background: rgba(255,255,255,.9); }
    .small-no:active{ transform: translateX(-50%) scale(.98); }

    .success{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(240,170,200,.28);
      color: rgba(50,20,35,.9);
      font-size: 14px;
      max-width: 60ch;
      text-align:center;
      display:none;
    }

    /* Mobile tweaks */
    @media (max-width: 820px){
      .content{ padding: 34px 18px 18px 44px; }
      .reasons{ grid-template-columns: 1fr; }
      .scratch-wrap{ grid-template-columns: 1fr; }
      .hint{ top:-46px; font-size:12px; }
      .nav-zone{ width:14%; } /* keep swiping primary */
      .scratch-under{ top: 92px; height:190px; }
      .constellation{ min-height: 420px; }
    }
  </style>
</head>

<body>
  <div class="bg-hearts" id="bgHearts" aria-hidden="true"></div>

  <div class="wrap">
    <div class="stage">
      <div class="hint">
        Swipe <kbd>‚Üí</kbd> / <kbd>‚Üê</kbd> on mobile ‚Ä¢ click edges on desktop ‚Ä¢ arrows work too
      </div>

      <div class="book" id="book">
        <div class="book-inner">
          <div class="nav-zone nav-left" id="navLeft" title="Previous page"></div>
          <div class="nav-zone nav-right" id="navRight" title="Next page"></div>

          <div class="pages" id="pages">

            <!-- PAGE 1: Cover -->
            <section class="page" data-index="0" style="z-index:6">
              <div class="content">
                <div class="topline">
                  <span class="badge">Valentine‚Äôs Card</span>
                  <span id="pageCountA">Page 1 / 5</span>
                </div>

                <div style="margin-top:10px">
                  <div class="cover-name engraved">Lexi</div>
                  <div class="subtitle" style="margin-top:14px">My Favorite Person</div>
                </div>

                <div class="divider"></div>

                <p class="note">
                  A tiny interactive card‚Äîmade just for you. üíó<br>
                  (Turn the page like a little book.)
                </p>

                <div style="margin-top:auto; display:flex; gap:12px; align-items:center; justify-content:space-between;">
                  <div class="note" style="margin:0; opacity:.85">
                    Tip: swipe left/right on mobile
                  </div>
                  <div class="badge" style="background:rgba(255,255,255,.65)">‚ô•</div>
                </div>
              </div>
            </section>

            <!-- PAGE 2: 15 reasons (scrollable + secrets) -->
            <section class="page" data-index="1" style="z-index:5">
              <div class="content">
                <div class="topline">
                  <span class="badge">Chapter One</span>
                  <span>15 Reasons I Like You</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  15 Reasons I Like You
                </h2>

                <div class="scrollable">
                  <p class="note" style="margin-top:0">
                    Just a few‚Ä¶ but you know I could keep going.
                  </p>

                  <div class="reasons" id="reasonsGrid"></div>

                  <div class="secret-footer">
                    <div class="secret-title">little secrets</div>
                    <div class="secret-lines">
                      <div>‚Ä¢ (secret message one)</div>
                      <div>‚Ä¢ (secret message two)</div>
                      <div>‚Ä¢ (secret message three)</div>
                      <div>‚Ä¢ (secret message four)</div>
                    </div>
                  </div>

                  <p class="note" style="margin-top:12px; opacity:.9">
                    (P.S. They‚Äôre in a cute random order every time.)
                  </p>
                </div>
              </div>
            </section>

            <!-- PAGE 3: Scratch to reveal + compliment jar (scrollable on mobile) -->
            <section class="page" data-index="2" style="z-index:4">
              <div class="content">
                <div class="topline">
                  <span class="badge">Interactive</span>
                  <span>Scratch & ‚ÄúCompliment Jar‚Äù</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  Little Surprises
                </h2>

                <div class="scrollable">
                  <p class="note" style="margin-top:0">
                    Scratch the panel to reveal a message, then tap a chip to pull a note from the jar.
                  </p>

                  <div class="scratch-wrap">
                    <div class="scratch-card">
                      <h3>Scratch to Reveal</h3>
                      <p>Use your finger or mouse. Scratch enough and it shows through.</p>

                      <div class="scratch-under" aria-hidden="true">You make my days softer.</div>
                      <canvas id="scratchCanvas" width="900" height="360"></canvas>
                    </div>

                    <div class="mini-panel">
                      <h3>Compliment Jar</h3>
                      <div class="chips" id="chips"></div>
                      <div class="jar-note" id="jarNote">Pick one üíå</div>
                    </div>
                  </div>

                  <div style="height:10px"></div>
                </div>
              </div>
            </section>

            <!-- PAGE 4: Heart constellation (tooltip fixed bottom) -->
            <section class="page" data-index="3" style="z-index:3">
              <div class="content">
                <div class="topline">
                  <span class="badge">Interactive</span>
                  <span>Tap the Hearts</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  A Little Constellation
                </h2>

                <div class="scrollable">
                  <p class="note" style="margin-top:0">
                    Tap the hearts to reveal tiny ‚Äúmoments‚Äù (you can edit these to match your story).
                  </p>

                  <div class="constellation" id="constellation">
                    <div class="tooltip" id="tooltip">
                      <strong>Tap a heart</strong> to reveal a note.
                      <span class="pill" id="foundPill">0 / 6 found</span>
                    </div>
                  </div>

                  <p class="note" style="margin-top:12px; opacity:.9">
                    (Replace these with inside jokes, dates, places, or memories.)
                  </p>
                </div>
              </div>
            </section>

            <!-- PAGE 5: Valentine question (NO can never overlap YES) -->
            <section class="page" data-index="4" style="z-index:2">
              <div class="content" style="position:relative">
                <div class="topline">
                  <span class="badge">Final Page</span>
                  <span>Question Time</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:30px; color:rgba(70,25,50,.92); text-align:center">
                  Will you be my valentine?
                </h2>

                <div class="cta" id="ctaArea">
                  <button class="big-yes" id="yesBtn">YES üíñ</button>
                  <div class="success" id="successMsg">
                    YAY! üíó<br>
                    Now come here so I can celebrate properly.
                  </div>
                </div>

                <button class="small-no" id="noBtn">no</button>
              </div>
            </section>

          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    /* ---------------------------
       Background hearts
    ---------------------------- */
    (function makeBgHearts(){
      const bg = document.getElementById('bgHearts');
      const count = 18;
      for(let i=0;i<count;i++){
        const h = document.createElement('div');
        h.className = 'heart';
        const left = Math.random()*100;
        const size = 10 + Math.random()*16;
        const dur = 8 + Math.random()*10;
        const delay = Math.random()*dur;
        h.style.left = left + 'vw';
        h.style.bottom = (-10 - Math.random()*30) + 'vh';
        h.style.width = size + 'px';
        h.style.height = size + 'px';
        h.style.animationDuration = dur + 's';
        h.style.animationDelay = (-delay) + 's';
        bg.appendChild(h);
      }
    })();

    /* ---------------------------
       Page flip logic + swipe on mobile
    ---------------------------- */
    const pages = Array.from(document.querySelectorAll('.page'));
    let current = 0;

    function updatePageCounters(){
      const total = pages.length;
      const el = document.getElementById('pageCountA');
      if(el) el.textContent = `Page ${current+1} / ${total}`;
    }

    function goTo(idx){
      idx = Math.max(0, Math.min(pages.length-1, idx));
      current = idx;

      pages.forEach((p,i)=>{
        if(i < current) p.classList.add('flipped');
        else p.classList.remove('flipped');
      });

      pages.forEach((p,i)=> p.style.zIndex = (pages.length - i));
      updatePageCounters();
    }

    function next(){ goTo(current + 1); }
    function prev(){ goTo(current - 1); }

    document.getElementById('navRight').addEventListener('click', next);
    document.getElementById('navLeft').addEventListener('click', prev);

    window.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowRight') next();
      if(e.key === 'ArrowLeft') prev();
    });

    // Swipe (mobile only-ish): detect horizontal swipe on the book
    const book = document.getElementById('book');
    let touchStartX = 0, touchStartY = 0, tracking = false;

    book.addEventListener('touchstart', (e)=>{
      if(!e.touches || e.touches.length !== 1) return;
      const t = e.touches[0];
      touchStartX = t.clientX;
      touchStartY = t.clientY;
      tracking = true;
    }, {passive:true});

    book.addEventListener('touchmove', (e)=>{
      if(!tracking || !e.touches || e.touches.length !== 1) return;
      const t = e.touches[0];
      const dx = t.clientX - touchStartX;
      const dy = t.clientY - touchStartY;

      // If it's clearly horizontal, prevent scrolling from stealing it
      if(Math.abs(dx) > 18 && Math.abs(dx) > Math.abs(dy) + 10){
        e.preventDefault();
      }
    }, {passive:false});

    book.addEventListener('touchend', (e)=>{
      if(!tracking) return;
      tracking = false;

      const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
      if(!t) return;
      const dx = t.clientX - touchStartX;
      const dy = t.clientY - touchStartY;

      // Ignore if mostly vertical
      if(Math.abs(dy) > Math.abs(dx)) return;

      if(dx < -60) next();      // swipe left -> next page
      else if(dx > 60) prev();  // swipe right -> prev page
    }, {passive:true});

    goTo(0);

    /* ---------------------------
       Page 2: 15 reasons (random order)
    ---------------------------- */
    const reasons = [
      "How easy you are to talk to",
      "Your laugh",
      "Your beautiful smile",
      "Your adorable little frown",
      "Your mesmerizing eyes",
      "The way you talk to me",
      "Your weirdness",
      "How happy you make me",
      "How sweet you are",
      "Your sense of humor",
      "Your kindness",
      "Your energy",
      "Your thoughtfulness",
      "How you make simple moments feel special",
      "The way you‚Äôre unapologetically you"
    ];

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    const reasonsGrid = document.getElementById('reasonsGrid');
    reasonsGrid.innerHTML = "";
    shuffle(reasons).forEach((text, idx)=>{
      const item = document.createElement('div');
      item.className = 'reason';
      item.innerHTML = `<div class="dot">${idx+1}</div><span>${text}</span>`;
      reasonsGrid.appendChild(item);
    });

    /* ---------------------------
       Page 3: Scratch to reveal (mobile fixed)
    ---------------------------- */
    const canvas = document.getElementById('scratchCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let revealed = false;

    function fitScratchCanvas(){
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      canvas.width = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
      drawScratchLayer();
      revealed = false;
    }

    function drawScratchLayer(){
      const rect = canvas.getBoundingClientRect();
      const w = rect.width;
      const h = rect.height;

      // IMPORTANT: reset composite so foil draws correctly
      ctx.globalCompositeOperation = 'source-over';
      ctx.clearRect(0,0,w,h);

      const grad = ctx.createLinearGradient(0,0,w,h);
      grad.addColorStop(0, 'rgba(255,77,141,.92)');
      grad.addColorStop(1, 'rgba(255,133,168,.78)');
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,w,h);

      // sparkle lines
      ctx.globalAlpha = 0.25;
      for(let i=0;i<14;i++){
        ctx.beginPath();
        const y = (i/14)*h;
        ctx.moveTo(0, y);
        ctx.lineTo(w, y + 18);
        ctx.lineWidth = 2;
        ctx.strokeStyle = 'rgba(255,255,255,.7)';
        ctx.stroke();
      }
      ctx.globalAlpha = 1;

      ctx.font = '800 18px Inter, sans-serif';
      ctx.fillStyle = 'rgba(255,255,255,.94)';
      ctx.textAlign = 'center';
      ctx.fillText('Scratch here ‚ú®', w/2, h/2 + 6);
    }

    function scratchAt(clientX, clientY){
      const rect = canvas.getBoundingClientRect();
      const x = clientX - rect.left;
      const y = clientY - rect.top;

      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(x, y, 20, 0, Math.PI*2);
      ctx.fill();
      ctx.globalCompositeOperation = 'source-over';

      maybeReveal();
    }

    function getScratchPercent(){
      const w = canvas.width;
      const h = canvas.height;
      // sample in device pixels
      const step = Math.floor(24 * (window.devicePixelRatio || 1));
      const img = ctx.getImageData(0,0,w,h).data;
      let total = 0, cleared = 0;
      for(let y=0; y<h; y+=step){
        for(let x=0; x<w; x+=step){
          const i = (y*w + x)*4 + 3;
          total++;
          if(img[i] < 30) cleared++;
        }
      }
      return cleared / total;
    }

    function maybeReveal(){
      if(revealed) return;
      if(getScratchPercent() > 0.38){
        revealed = true;
        // fade remaining layer
        ctx.globalCompositeOperation = 'destination-out';
        let t = 0;
        const rect = canvas.getBoundingClientRect();
        const w = rect.width, h = rect.height;
        const fade = () => {
          t += 1;
          ctx.fillStyle = 'rgba(0,0,0,.22)';
          ctx.fillRect(0,0,w,h);
          if(t < 16) requestAnimationFrame(fade);
        };
        requestAnimationFrame(fade);
        ctx.globalCompositeOperation = 'source-over';
      }
    }

    function onPointerDown(e){
      isDrawing = true;
      const p = e.touches ? e.touches[0] : e;
      scratchAt(p.clientX, p.clientY);
      e.preventDefault();
    }
    function onPointerMove(e){
      if(!isDrawing) return;
      const p = e.touches ? e.touches[0] : e;
      scratchAt(p.clientX, p.clientY);
      e.preventDefault();
    }
    function onPointerUp(){ isDrawing = false; }

    canvas.addEventListener('mousedown', onPointerDown);
    canvas.addEventListener('mousemove', onPointerMove);
    window.addEventListener('mouseup', onPointerUp);

    canvas.addEventListener('touchstart', onPointerDown, {passive:false});
    canvas.addEventListener('touchmove', onPointerMove, {passive:false});
    canvas.addEventListener('touchend', onPointerUp, {passive:true});

    window.addEventListener('resize', ()=>{ requestAnimationFrame(fitScratchCanvas); });
    requestAnimationFrame(fitScratchCanvas);

    /* ---------------------------
       Page 3: Compliment Jar
    ---------------------------- */
    const jarNotes = [
      "I like the way you make me feel calm and excited at the same time.",
      "You‚Äôre the kind of person I‚Äôd choose in every universe.",
      "Talking to you feels like a warm hoodie.",
      "You make ordinary days feel like something worth remembering.",
      "Your energy is the best kind of contagious.",
      "You‚Äôre effortlessly lovable. (Yes, that‚Äôs a thing.)"
    ];
    const chipLabels = ["Pick one", "Another", "Again", "More", "One more", "Surprise"];
    const chips = document.getElementById('chips');
    const jarNote = document.getElementById('jarNote');

    function randomFrom(a){ return a[Math.floor(Math.random()*a.length)] }

    chips.innerHTML = "";
    chipLabels.forEach((label)=>{
      const b = document.createElement('button');
      b.className = 'chip';
      b.type = 'button';
      b.textContent = label;
      b.addEventListener('click', ()=>{
        jarNote.textContent = randomFrom(jarNotes);
      });
      chips.appendChild(b);
    });

    /* ---------------------------
       Page 4: Constellation hearts (tooltip fixed bottom)
    ---------------------------- */
    const constellation = document.getElementById('constellation');
    const tooltip = document.getElementById('tooltip');
    const foundPill = document.getElementById('foundPill');

    const memoryNotes = [
      "A moment I realized I really like you.",
      "Something about your smile that stays in my head.",
      "The way you can make me laugh instantly.",
      "How you make things feel easier.",
      "A little thing you do that I adore.",
      "The ‚Äòthis is my favorite person‚Äô feeling."
    ];

    let found = 0;
    const heartsPos = [
      {x:14, y:22},{x:38, y:16},{x:62, y:24},
      {x:22, y:46},{x:52, y:42},{x:76, y:52}
    ];

    // clear then add hearts
    Array.from(constellation.querySelectorAll('.spark')).forEach(n=>n.remove());

    heartsPos.forEach((pos, i)=>{
      const s = document.createElement('div');
      s.className = 'spark';
      s.style.left = `calc(${pos.x}% - 8px)`;
      s.style.top  = `calc(${pos.y}% - 8px)`;
      s.dataset.idx = i;
      s.dataset.opened = "0";
      s.addEventListener('click', ()=>{
        if(s.dataset.opened === "0"){
          s.dataset.opened = "1";
          found++;
          foundPill.textContent = `${found} / 6 found`;
        }
        const note = memoryNotes[i];
        tooltip.innerHTML = `<strong>Note:</strong> ${note}<span class="pill">${found} / 6 found</span>`;
      });
      constellation.appendChild(s);
    });

    /* ---------------------------
       Final page: yes/no behavior (NO never overlaps YES)
    ---------------------------- */
    const yesBtn = document.getElementById('yesBtn');
    const noBtn = document.getElementById('noBtn');
    const ctaArea = document.getElementById('ctaArea');
    const successMsg = document.getElementById('successMsg');

    yesBtn.addEventListener('click', ()=>{
      successMsg.style.display = 'block';
      yesBtn.textContent = "YES!! üíò";
    });

    function teleportNo(){
      const page = noBtn.closest('.page');
      const pageRect = page.getBoundingClientRect();
      const yesRect = yesBtn.getBoundingClientRect();

      // build a "no-go" rectangle around YES button (in page coords)
      const noGo = {
        left: (yesRect.left - pageRect.left) - 18,
        right:(yesRect.right - pageRect.left) + 18,
        top:  (yesRect.top - pageRect.top) - 18,
        bottom:(yesRect.bottom - pageRect.top) + 18
      };

      const btnW = 120, btnH = 38;
      const pad = 22;

      // allowed area inside page
      const minX = 44; // avoid spine
      const maxX = pageRect.width - pad - btnW;
      const minY = Math.max(noGo.bottom + 16, pageRect.height*0.48); // always below YES
      const maxY = pageRect.height - pad - btnH;

      // fallback if very small screens
      const safeMinY = Math.min(minY, maxY);

      let x, y;
      // try a few times to find a spot not intersecting the no-go zone
      for(let tries=0; tries<20; tries++){
        x = minX + Math.random() * Math.max(10, (maxX - minX));
        y = safeMinY + Math.random() * Math.max(10, (maxY - safeMinY));

        const intersects =
          x < noGo.right &&
          x + btnW > noGo.left &&
          y < noGo.bottom &&
          y + btnH > noGo.top;

        if(!intersects) break;
      }

      noBtn.style.left = x + 'px';
      noBtn.style.top = y + 'px';
      noBtn.style.transform = 'translateX(0)';

      noBtn.animate(
        [{transform:'translateX(0) scale(1)'},{transform:'translateX(0) scale(1.05)'},{transform:'translateX(0) scale(1)'}],
        {duration:240, easing:'ease-out'}
      );
    }

    function centerNo(){
      noBtn.style.left = '50%';
      noBtn.style.top = '67%';
      noBtn.style.transform = 'translateX(-50%)';
    }
    centerNo();

    noBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      teleportNo();
    });
  </script>
</body>
</html>
