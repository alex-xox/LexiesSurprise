<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lexi ‚Äî My Favorite Person</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@400;600&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#fff0f6;
      --bg2:#ffe3ec;
      --ink:#2b2b2f;
      --muted:#6a5d6a;
      --rose:#ff4d8d;
      --rose2:#ff85a8;
      --paper:#fffafc;
      --paper2:#fff3f8;
      --edge:#f0d7e4;
      --shadow: 0 20px 60px rgba(35, 10, 25, .18);
      --shadow2: 0 10px 30px rgba(35, 10, 25, .14);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at 20% 20%, #ffffff 0%, transparent 55%),
        radial-gradient(900px 700px at 85% 25%, #ffffff 0%, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
    }

    /* subtle floating hearts in background */
    .bg-hearts{
      position:fixed; inset:0; pointer-events:none; overflow:hidden;
      filter: drop-shadow(0 8px 12px rgba(0,0,0,.06));
      opacity:.55;
    }
    .heart{
      position:absolute;
      width:16px; height:16px;
      transform: rotate(45deg);
      background: linear-gradient(135deg, rgba(255,77,141,.85), rgba(255,133,168,.75));
      border-radius: 4px;
      animation: floatUp linear infinite;
    }
    .heart::before,.heart::after{
      content:"";
      position:absolute; width:16px; height:16px;
      background: inherit;
      border-radius:50%;
    }
    .heart::before{ left:-8px; top:0;}
    .heart::after{ top:-8px; left:0;}
    @keyframes floatUp{
      from{ transform: translateY(20vh) rotate(45deg); opacity:0;}
      10%{opacity:.85}
      to{ transform: translateY(-120vh) rotate(45deg); opacity:0;}
    }

    /* Layout */
    .wrap{
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    .stage{
      width:min(980px, 96vw);
      height:min(660px, 86vh);
      position:relative;
      perspective: 1400px;
    }

    .hint{
      position:absolute;
      top:-40px; left:0; right:0;
      text-align:center;
      font-size:13px;
      color:rgba(60,25,45,.65);
      user-select:none;
    }
    .hint kbd{
      font: 600 12px/1 Inter, sans-serif;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.65);
      border:1px solid rgba(240, 170, 200, .65);
      box-shadow: 0 8px 16px rgba(0,0,0,.05);
    }

    /* Card Book */
    .book{
      width:100%;
      height:100%;
      position:relative;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background:
        radial-gradient(120% 180% at 0% 0%, rgba(255,255,255,.85), rgba(255,255,255,.15)),
        linear-gradient(135deg, rgba(255,255,255,.65), rgba(255,255,255,.35));
      padding:18px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 133, 168, .35);
    }

    .book-inner{
      width:100%;
      height:100%;
      position:relative;
      border-radius: calc(var(--radius) - 8px);
      background: linear-gradient(135deg, rgba(255,255,255,.88), rgba(255,255,255,.76));
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(240, 170, 200, .25);
    }

    /* Navigation tap zones */
    .nav-zone{
      position:absolute; top:0; bottom:0;
      width:18%;
      z-index:50;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .nav-left{ left:0;}
    .nav-right{ right:0;}
    .nav-zone::after{
      content:"";
      position:absolute; inset:0;
      opacity:0;
      transition:opacity .2s ease;
    }
    .nav-left::after{
      background: linear-gradient(90deg, rgba(255,77,141,.18), transparent);
    }
    .nav-right::after{
      background: linear-gradient(270deg, rgba(255,77,141,.18), transparent);
    }
    .nav-zone:hover::after{opacity:1}

    /* Pages stack */
    .pages{
      position:absolute; inset:0;
      border-radius: calc(var(--radius) - 8px);
    }

    .page{
      position:absolute; inset:0;
      border-radius: calc(var(--radius) - 8px);
      background: linear-gradient(135deg, var(--paper), var(--paper2));
      transform-style: preserve-3d;
      transform-origin: left center;
      box-shadow: var(--shadow2);
      border: 1px solid rgba(240, 170, 200, .35);
      overflow:hidden;
    }

    /* Paper edge + spine vibe */
    .page::before{
      content:"";
      position:absolute; left:0; top:0; bottom:0;
      width:14px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.15)),
        linear-gradient(90deg, rgba(240,215,228,.9), rgba(240,215,228,.2));
      box-shadow: inset -1px 0 0 rgba(240,170,200,.25);
      opacity:.95;
    }

    /* When flipped */
    .page.flipped{
      transform: rotateY(-180deg);
    }

    /* Smooth flipping */
    .page{
      transition: transform 850ms cubic-bezier(.2,.9,.2,1);
    }

    /* Page content */
    .content{
      position:absolute;
      inset:0;
      padding: 40px 42px 36px 56px; /* extra left for edge */
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .topline{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      color: var(--muted);
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .badge{
      padding:7px 10px;
      border-radius:999px;
      background: rgba(255,77,141,.10);
      border: 1px solid rgba(255,77,141,.22);
      box-shadow: 0 8px 16px rgba(0,0,0,.04);
      font-weight:700;
      color: rgba(120, 35, 70, .9);
    }

    h1,h2,h3{margin:0}
    .cover-name{
      font-family: "Great Vibes", cursive;
      font-size: clamp(52px, 7.3vw, 86px);
      line-height: 1;
      letter-spacing: .02em;
      color: rgba(90, 20, 55, .95);
      text-shadow:
        0 2px 0 rgba(255,255,255,.8),
        0 18px 40px rgba(255,77,141,.18);
    }
    .engraved{
      position:relative;
    }
    .engraved::after{
      content:"";
      position:absolute;
      left:0; right:0;
      bottom:-10px;
      height:2px;
      background: linear-gradient(90deg, transparent, rgba(255,77,141,.55), transparent);
      filter: blur(.2px);
    }

    .subtitle{
      font-family: "Playfair Display", serif;
      font-weight:600;
      font-size: clamp(18px, 2.2vw, 26px);
      color: rgba(70, 30, 50, .88);
    }

    .note{
      color: rgba(60,25,45,.75);
      font-size: 14px;
      line-height: 1.45;
      max-width: 56ch;
    }

    .divider{
      height:1px;
      width:100%;
      background: linear-gradient(90deg, transparent, rgba(255,77,141,.30), transparent);
      margin: 8px 0;
    }

    /* Reasons list */
    .reasons{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px 14px;
      margin-top:6px;
    }
    .reason{
      display:flex;
      gap:10px;
      padding:10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(240,170,200,.25);
      box-shadow: 0 10px 18px rgba(0,0,0,.04);
      align-items:flex-start;
      min-height: 44px;
    }
    .dot{
      width:22px; height:22px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,77,141,.92), rgba(255,133,168,.65));
      display:grid;
      place-items:center;
      color:white;
      font-weight:900;
      font-size:12px;
      flex:0 0 auto;
      box-shadow: 0 10px 18px rgba(255,77,141,.20);
    }
    .reason span{
      font-size: 13px;
      line-height: 1.25;
      color: rgba(45, 20, 35, .88);
      font-weight:600;
    }

    /* Interactive Page 1: Scratch-to-reveal */
    .scratch-wrap{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      align-items:stretch;
      margin-top:8px;
    }
    .scratch-card{
      border-radius: 18px;
      background: rgba(255,255,255,.68);
      border: 1px solid rgba(240,170,200,.28);
      box-shadow: 0 12px 22px rgba(0,0,0,.05);
      padding:14px;
      position:relative;
      overflow:hidden;
      min-height: 260px;
    }
    .scratch-card h3{
      font-family:"Playfair Display", serif;
      font-size:18px;
      color: rgba(70, 25, 50, .9);
      margin-bottom:6px;
    }
    .scratch-card p{
      margin:0 0 10px;
      font-size: 13px;
      color: rgba(60,25,45,.72);
      line-height:1.35;
    }
    #scratchCanvas{
      width:100%;
      height: 170px;
      border-radius: 14px;
      display:block;
      background: linear-gradient(135deg, rgba(255,77,141,.12), rgba(255,133,168,.08));
      border: 1px dashed rgba(255,77,141,.35);
    }
    .hidden-message{
      position:absolute;
      left:14px; right:14px;
      bottom:14px;
      padding:14px 14px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(255,77,141,.10), rgba(255,133,168,.08));
      border: 1px solid rgba(255,77,141,.18);
      box-shadow: 0 10px 18px rgba(0,0,0,.04);
      text-align:center;
      font-family:"Great Vibes", cursive;
      font-size: 34px;
      color: rgba(90, 20, 55, .92);
      user-select:none;
    }

    .mini-panel{
      border-radius: 18px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(240,170,200,.25);
      box-shadow: 0 12px 22px rgba(0,0,0,.05);
      padding:14px;
      min-height: 260px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .mini-panel h3{
      font-family:"Playfair Display", serif;
      font-size:18px;
      margin:0;
      color: rgba(70, 25, 50, .9);
    }
    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .chip{
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,77,141,.10);
      border: 1px solid rgba(255,77,141,.22);
      font-weight:800;
      font-size:12px;
      color: rgba(90, 20, 55, .9);
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, background .12s ease;
    }
    .chip:active{ transform: scale(.98); }
    .chip:hover{ background: rgba(255,77,141,.14); }
    .jar-note{
      margin-top:auto;
      padding:12px;
      border-radius: 14px;
      background: rgba(255,255,255,.8);
      border: 1px solid rgba(240,170,200,.28);
      color: rgba(50, 20, 35, .85);
      font-size:13px;
      line-height:1.35;
      min-height: 74px;
      display:flex;
      align-items:center;
    }

    /* Interactive Page 2: Heart constellation */
    .constellation{
      position:relative;
      flex:1;
      border-radius: 18px;
      background:
        radial-gradient(800px 300px at 20% 20%, rgba(255,255,255,.9), rgba(255,255,255,.45)),
        linear-gradient(135deg, rgba(255,77,141,.08), rgba(255,133,168,.06));
      border: 1px solid rgba(255,77,141,.18);
      box-shadow: 0 16px 30px rgba(0,0,0,.06);
      overflow:hidden;
      min-height: 320px;
    }
    .spark{
      position:absolute;
      width:14px; height:14px;
      transform: rotate(45deg);
      border-radius: 3px;
      background: linear-gradient(135deg, rgba(255,77,141,.92), rgba(255,133,168,.7));
      cursor:pointer;
      box-shadow: 0 12px 20px rgba(255,77,141,.22);
      transition: transform .12s ease;
    }
    .spark::before,.spark::after{
      content:"";
      position:absolute; width:14px; height:14px;
      background: inherit;
      border-radius:50%;
    }
    .spark::before{ left:-7px; top:0;}
    .spark::after{ top:-7px; left:0;}
    .spark:hover{ transform: rotate(45deg) scale(1.06); }
    .tooltip{
      position:absolute;
      left:16px; bottom:16px; right:16px;
      padding:12px 14px;
      border-radius: 14px;
      background: rgba(255,255,255,.85);
      border: 1px solid rgba(240,170,200,.35);
      box-shadow: 0 18px 40px rgba(0,0,0,.08);
      font-size: 13px;
      color: rgba(50,20,35,.9);
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .tooltip strong{font-weight:900}
    .tooltip .pill{
      margin-left:auto;
      padding:7px 10px;
      border-radius:999px;
      background: rgba(255,77,141,.10);
      border: 1px solid rgba(255,77,141,.22);
      font-weight:900;
      font-size:12px;
      color: rgba(90, 20, 55, .92);
      white-space:nowrap;
    }

    /* Final page buttons */
    .cta{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:14px;
      flex:1;
      padding-bottom: 10px;
    }
    .big-yes{
      width:min(420px, 86%);
      height:84px;
      border:0;
      border-radius: 18px;
      font-weight: 1000;
      font-size: 28px;
      color:white;
      cursor:pointer;
      background: linear-gradient(135deg, rgba(255,77,141,.98), rgba(255,133,168,.82));
      box-shadow: 0 22px 46px rgba(255,77,141,.28);
      transition: transform .12s ease, filter .12s ease;
    }
    .big-yes:hover{ filter: brightness(1.02); }
    .big-yes:active{ transform: scale(.99); }

    .small-no{
      position:absolute;
      left:50%;
      transform: translateX(-50%);
      width:120px;
      height:38px;
      border-radius: 999px;
      border: 1px solid rgba(255,77,141,.28);
      background: rgba(255,255,255,.75);
      color: rgba(90, 20, 55, .92);
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 12px 24px rgba(0,0,0,.08);
      transition: transform .12s ease, background .12s ease;
    }
    .small-no:hover{ background: rgba(255,255,255,.9); }
    .small-no:active{ transform: translateX(-50%) scale(.98); }

    .success{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(240,170,200,.28);
      color: rgba(50,20,35,.9);
      font-size: 14px;
      max-width: 60ch;
      text-align:center;
      display:none;
    }

    /* Mobile tweaks */
    @media (max-width: 820px){
      .content{ padding: 34px 22px 24px 44px; }
      .reasons{ grid-template-columns: 1fr; }
      .scratch-wrap{ grid-template-columns: 1fr; }
      .hint{ top:-46px; font-size:12px; }
      .nav-zone{ width:22%; }
    }
  </style>
</head>

<body>
  <div class="bg-hearts" id="bgHearts" aria-hidden="true"></div>

  <div class="wrap">
    <div class="stage">
      <div class="hint">
        Click the <kbd>right edge</kbd> to turn the page ‚Ä¢ click the <kbd>left edge</kbd> to go back
      </div>

      <div class="book">
        <div class="book-inner">
          <div class="nav-zone nav-left" id="navLeft" title="Previous page"></div>
          <div class="nav-zone nav-right" id="navRight" title="Next page"></div>

          <div class="pages" id="pages">

            <!-- PAGE 1: Cover -->
            <section class="page" data-index="0" style="z-index:6">
              <div class="content">
                <div class="topline">
                  <span class="badge">Valentine‚Äôs Card</span>
                  <span id="pageCountA">Page 1 / 5</span>
                </div>

                <div style="margin-top:10px">
                  <div class="cover-name engraved">Lexi</div>
                  <div class="subtitle" style="margin-top:14px">My Favorite Person</div>
                </div>

                <div class="divider"></div>

                <p class="note">
                  A tiny interactive card‚Äîmade just for you. üíó<br>
                  (Turn the page from the right side like a real little book.)
                </p>

                <div style="margin-top:auto; display:flex; gap:12px; align-items:center; justify-content:space-between;">
                  <div class="note" style="margin:0; opacity:.85">
                    Tip: keyboard works too ‚Üí <strong>‚Üí</strong> / <strong>‚Üê</strong>
                  </div>
                  <div class="badge" style="background:rgba(255,255,255,.65)">‚ô•</div>
                </div>
              </div>
            </section>

            <!-- PAGE 2: 15 reasons -->
            <section class="page" data-index="1" style="z-index:5">
              <div class="content">
                <div class="topline">
                  <span class="badge">Chapter One</span>
                  <span>15 Reasons I Like You</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  15 Reasons I Like You
                </h2>
                <p class="note" style="margin-top:-6px">
                  Just a few‚Ä¶ but you know I could keep going.
                </p>

                <div class="reasons" id="reasonsGrid"></div>

                <p class="note" style="margin-top:auto; opacity:.9">
                  (P.S. They‚Äôre in a cute random order every time.)
                </p>
              </div>
            </section>

            <!-- PAGE 3: Scratch to reveal + compliment jar -->
            <section class="page" data-index="2" style="z-index:4">
              <div class="content">
                <div class="topline">
                  <span class="badge">Interactive</span>
                  <span>Scratch & ‚ÄúCompliment Jar‚Äù</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  Little Surprises
                </h2>
                <p class="note" style="margin-top:-6px">
                  Scratch the panel to reveal a message, then tap a chip to pull a note from the jar.
                </p>

                <div class="scratch-wrap">
                  <div class="scratch-card">
                    <h3>Scratch to Reveal</h3>
                    <p>Use your finger or mouse. Scratch enough and the message shows through.</p>
                    <canvas id="scratchCanvas" width="900" height="360"></canvas>
                    <div class="hidden-message" aria-hidden="true">You make my days softer.</div>
                  </div>

                  <div class="mini-panel">
                    <h3>Compliment Jar</h3>
                    <div class="chips" id="chips"></div>
                    <div class="jar-note" id="jarNote">Pick one üíå</div>
                  </div>
                </div>
              </div>
            </section>

            <!-- PAGE 4: Heart constellation -->
            <section class="page" data-index="3" style="z-index:3">
              <div class="content">
                <div class="topline">
                  <span class="badge">Interactive</span>
                  <span>Tap the Hearts</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:28px; color:rgba(70,25,50,.92)">
                  A Little Constellation
                </h2>
                <p class="note" style="margin-top:-6px">
                  Tap the hearts to reveal tiny ‚Äúmoments‚Äù (you can edit these to match your story).
                </p>

                <div class="constellation" id="constellation">
                  <div class="tooltip" id="tooltip">
                    <strong>Tap a heart</strong> to reveal a note.
                    <span class="pill" id="foundPill">0 / 6 found</span>
                  </div>
                </div>

                <p class="note" style="margin-top:auto; opacity:.9">
                  (If you want, replace these with inside jokes, dates, places, or memories.)
                </p>
              </div>
            </section>

            <!-- PAGE 5: Valentine question -->
            <section class="page" data-index="4" style="z-index:2">
              <div class="content" style="position:relative">
                <div class="topline">
                  <span class="badge">Final Page</span>
                  <span>Question Time</span>
                </div>

                <h2 style="font-family:'Playfair Display',serif; font-size:30px; color:rgba(70,25,50,.92); text-align:center">
                  Will you be my valentine?
                </h2>
                <p class="note" style="text-align:center; margin-top:-6px">
                  I‚Äôm asking nicely. With a very big button. üôÇ
                </p>

                <div class="cta" id="ctaArea">
                  <button class="big-yes" id="yesBtn">YES üíñ</button>
                  <div class="success" id="successMsg">
                    YAY! üíó<br>
                    Now come here so I can celebrate properly.
                  </div>
                </div>

                <button class="small-no" id="noBtn" style="top: 67%;">no</button>
              </div>
            </section>

          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    /* ---------------------------
       Background hearts
    ---------------------------- */
    (function makeBgHearts(){
      const bg = document.getElementById('bgHearts');
      const count = 18;
      for(let i=0;i<count;i++){
        const h = document.createElement('div');
        h.className = 'heart';
        const left = Math.random()*100;
        const size = 10 + Math.random()*16;
        const dur = 8 + Math.random()*10;
        const delay = Math.random()*dur;
        h.style.left = left + 'vw';
        h.style.bottom = (-10 - Math.random()*30) + 'vh';
        h.style.width = size + 'px';
        h.style.height = size + 'px';
        h.style.animationDuration = dur + 's';
        h.style.animationDelay = (-delay) + 's';
        bg.appendChild(h);
      }
    })();

    /* ---------------------------
       Page flip logic
    ---------------------------- */
    const pages = Array.from(document.querySelectorAll('.page'));
    let current = 0; // visible top page index

    function updatePageCounters(){
      const total = pages.length;
      const el = document.getElementById('pageCountA');
      if(el) el.textContent = `Page ${current+1} / ${total}`;
    }

    function goTo(idx){
      idx = Math.max(0, Math.min(pages.length-1, idx));
      current = idx;

      // flip pages before current
      pages.forEach((p,i)=>{
        if(i < current) p.classList.add('flipped');
        else p.classList.remove('flipped');
      });

      // stack z-index so unflipped pages are on top
      pages.forEach((p,i)=>{
        const z = (pages.length - i);
        p.style.zIndex = z;
      });

      updatePageCounters();
    }

    function next(){ goTo(current + 1); }
    function prev(){ goTo(current - 1); }

    document.getElementById('navRight').addEventListener('click', next);
    document.getElementById('navLeft').addEventListener('click', prev);

    window.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowRight') next();
      if(e.key === 'ArrowLeft') prev();
    });

    goTo(0);

    /* ---------------------------
       Page 2: 15 reasons (random order)
    ---------------------------- */
    const reasons = [
      "How easy you are to talk to",
      "Your laugh",
      "Your beautiful smile",
      "Your adorable little frown",
      "Your mesmerizing eyes",
      "The way you talk to me",
      "Your weirdness",
      "How happy you make me",
      "How sweet you are",
      "Your sense of humor",
      "Your kindness",
      "Your energy",
      "Your thoughtfulness",
      "How you make simple moments feel special",
      "The way you‚Äôre unapologetically you"
    ];

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    const reasonsGrid = document.getElementById('reasonsGrid');
    shuffle(reasons).forEach((text, idx)=>{
      const item = document.createElement('div');
      item.className = 'reason';
      item.innerHTML = `<div class="dot">${idx+1}</div><span>${text}</span>`;
      reasonsGrid.appendChild(item);
    });

    /* ---------------------------
       Page 3: Scratch to reveal
    ---------------------------- */
    const canvas = document.getElementById('scratchCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;

    function fitScratchCanvas(){
      // keep internal resolution crisp
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      canvas.width = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
      drawScratchLayer();
    }

    function drawScratchLayer(){
      const w = canvas.getBoundingClientRect().width;
      const h = canvas.getBoundingClientRect().height;

      // base "foil"
      const grad = ctx.createLinearGradient(0,0,w,h);
      grad.addColorStop(0, 'rgba(255,77,141,.85)');
      grad.addColorStop(1, 'rgba(255,133,168,.75)');
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,w,h);

      // sparkle lines
      ctx.globalAlpha = 0.25;
      for(let i=0;i<14;i++){
        ctx.beginPath();
        const y = (i/14)*h;
        ctx.moveTo(0, y);
        ctx.lineTo(w, y + 18);
        ctx.lineWidth = 2;
        ctx.strokeStyle = 'rgba(255,255,255,.7)';
        ctx.stroke();
      }
      ctx.globalAlpha = 1;

      // label
      ctx.font = '800 18px Inter, sans-serif';
      ctx.fillStyle = 'rgba(255,255,255,.92)';
      ctx.textAlign = 'center';
      ctx.fillText('Scratch here ‚ú®', w/2, h/2 + 6);
    }

    function scratchAt(x,y){
      const rect = canvas.getBoundingClientRect();
      const cx = x - rect.left;
      const cy = y - rect.top;

      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(cx, cy, 18, 0, Math.PI*2);
      ctx.fill();
      ctx.globalCompositeOperation = 'source-over';

      // check progress
      maybeReveal();
    }

    function getScratchPercent(){
      // sample a small grid for speed (good enough)
      const w = Math.floor(canvas.width);
      const h = Math.floor(canvas.height);
      const sampleStep = 24; // px in device pixels
      const img = ctx.getImageData(0,0,w,h).data;
      let total = 0, cleared = 0;
      for(let y=0; y<h; y+=sampleStep){
        for(let x=0; x<w; x+=sampleStep){
          const i = (y*w + x)*4 + 3; // alpha channel
          total++;
          if(img[i] < 30) cleared++;
        }
      }
      return cleared / total;
    }

    let revealed = false;
    function maybeReveal(){
      if(revealed) return;
      const p = getScratchPercent();
      if(p > 0.38){
        revealed = true;
        // gently fade remaining layer
        const w = canvas.getBoundingClientRect().width;
        const h = canvas.getBoundingClientRect().height;
        ctx.globalCompositeOperation = 'destination-out';
        ctx.fillStyle = 'rgba(0,0,0,.25)';
        let t = 0;
        const fade = () => {
          t += 1;
          ctx.fillRect(0,0,w,h);
          if(t < 18) requestAnimationFrame(fade);
        };
        requestAnimationFrame(fade);
        ctx.globalCompositeOperation = 'source-over';
      }
    }

    function pointerDown(e){
      isDrawing = true;
      const p = (e.touches && e.touches[0]) ? e.touches[0] : e;
      scratchAt(p.clientX, p.clientY);
    }
    function pointerMove(e){
      if(!isDrawing) return;
      const p = (e.touches && e.touches[0]) ? e.touches[0] : e;
      scratchAt(p.clientX, p.clientY);
      e.preventDefault();
    }
    function pointerUp(){ isDrawing = false; }

    canvas.addEventListener('mousedown', pointerDown);
    canvas.addEventListener('mousemove', pointerMove);
    window.addEventListener('mouseup', pointerUp);

    canvas.addEventListener('touchstart', pointerDown, {passive:false});
    canvas.addEventListener('touchmove', pointerMove, {passive:false});
    window.addEventListener('touchend', pointerUp);

    window.addEventListener('resize', fitScratchCanvas);
    // ensure canvas has a size first
    requestAnimationFrame(fitScratchCanvas);

    /* ---------------------------
       Page 3: Compliment Jar
    ---------------------------- */
    const jarNotes = [
      "I like the way you make me feel calm and excited at the same time.",
      "You‚Äôre the kind of person I‚Äôd choose in every universe.",
      "Talking to you feels like a warm hoodie.",
      "You make ordinary days feel like something worth remembering.",
      "Your energy is the best kind of contagious.",
      "You‚Äôre effortlessly lovable. (Yes, that‚Äôs a thing.)"
    ];
    const chipLabels = ["Pick one", "Another", "Again", "More", "One more", "Surprise"];
    const chips = document.getElementById('chips');
    const jarNote = document.getElementById('jarNote');

    function randomFrom(a){ return a[Math.floor(Math.random()*a.length)] }

    chipLabels.forEach((label)=>{
      const b = document.createElement('button');
      b.className = 'chip';
      b.type = 'button';
      b.textContent = label;
      b.addEventListener('click', ()=>{
        jarNote.textContent = randomFrom(jarNotes);
      });
      chips.appendChild(b);
    });

    /* ---------------------------
       Page 4: Constellation hearts
    ---------------------------- */
    const constellation = document.getElementById('constellation');
    const tooltip = document.getElementById('tooltip');
    const foundPill = document.getElementById('foundPill');

    const memoryNotes = [
      "A moment I realized I really like you.",
      "Something about your smile that stays in my head.",
      "The way you can make me laugh instantly.",
      "How you make things feel easier.",
      "A little thing you do that I adore.",
      "The ‚Äòthis is my favorite person‚Äô feeling."
    ];

    let found = 0;
    const heartsPos = [
      {x:14, y:26},{x:38, y:18},{x:62, y:28},
      {x:22, y:58},{x:52, y:52},{x:76, y:64}
    ];

    heartsPos.forEach((pos, i)=>{
      const s = document.createElement('div');
      s.className = 'spark';
      s.style.left = `calc(${pos.x}% - 8px)`;
      s.style.top  = `calc(${pos.y}% - 8px)`;
      s.dataset.idx = i;
      s.dataset.opened = "0";
      s.addEventListener('click', ()=>{
        if(s.dataset.opened === "0"){
          s.dataset.opened = "1";
          found++;
          foundPill.textContent = `${found} / 6 found`;
        }
        const note = memoryNotes[i];
        tooltip.innerHTML = `<strong>Note:</strong> ${note}<span class="pill">${found} / 6 found</span>`;
      });
      constellation.appendChild(s);
    });

    /* ---------------------------
       Final page: yes/no behavior
    ---------------------------- */
    const yesBtn = document.getElementById('yesBtn');
    const noBtn = document.getElementById('noBtn');
    const ctaArea = document.getElementById('ctaArea');
    const successMsg = document.getElementById('successMsg');

    yesBtn.addEventListener('click', ()=>{
      successMsg.style.display = 'block';
      yesBtn.textContent = "YES!! üíò";
    });

    function teleportNo(){
      const page = noBtn.closest('.page');
      const rect = page.getBoundingClientRect();

      // keep it inside safe margins, and under the YES button region
      const pad = 34;
      const minY = rect.height * 0.48; // below headline & yes button area
      const maxY = rect.height - pad - 38;
      const minX = pad + 40; // avoid spine
      const maxX = rect.width - pad - 120;

      const x = minX + Math.random() * Math.max(10, (maxX - minX));
      const y = minY + Math.random() * Math.max(10, (maxY - minY));

      noBtn.style.left = x + 'px';
      noBtn.style.top = y + 'px';
      noBtn.style.transform = 'translateX(0)';

      // tiny playful wiggle
      noBtn.animate(
        [{transform:'translateX(0) scale(1)'},{transform:'translateX(0) scale(1.05)'},{transform:'translateX(0) scale(1)'}],
        {duration:240, easing:'ease-out'}
      );
    }

    // start centered under YES
    function centerNo(){
      noBtn.style.left = '50%';
      noBtn.style.top = '67%';
      noBtn.style.transform = 'translateX(-50%)';
    }
    centerNo();

    noBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      teleportNo();
    });
  </script>
</body>
</html>
